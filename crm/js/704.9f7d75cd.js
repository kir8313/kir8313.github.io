"use strict";(self["webpackChunkcrm_system"]=self["webpackChunkcrm_system"]||[]).push([[704],{4704:function(e,t,i){i.r(t),i.d(t,{default:function(){return z}});var s=i(3396),n=i(9242),a=i(7139);const o=e=>((0,s.dD)("data-v-1ab75e4e"),e=e(),(0,s.Cn)(),e),r=o((()=>(0,s._)("div",{class:"page-title"},[(0,s._)("h3",null,"Новая запись")],-1))),l={key:1,class:"center"},d=(0,s.Uk)(" Категорий пока нет. "),u=(0,s.Uk)("Добавьте новую категорию"),c={class:"input-field"},m=["value"],p=o((()=>(0,s._)("label",null,"Выберите категорию",-1))),h={class:"mb-2"},y={class:"radio-label"},v=o((()=>(0,s._)("span",null,"Доход",-1))),g={class:"radio-label"},$=o((()=>(0,s._)("span",null,"Расход",-1))),w={class:"input-field"},f=o((()=>(0,s._)("label",{for:"amount"},"Сумма",-1))),_={key:0,class:"helper-text invalid"},b={class:"input-field"},k=o((()=>(0,s._)("label",{for:"description"},"Описание",-1))),C={class:"helper-text invalid"},D=o((()=>(0,s._)("button",{class:"btn waves-effect waves-light",type:"submit"},[(0,s.Uk)(" Создать "),(0,s._)("i",{class:"material-icons right"},"send")],-1)));function L(e,t,i,o,M,L){const U=(0,s.up)("loader"),V=(0,s.up)("router-link");return(0,s.wg)(),(0,s.iD)("div",null,[r,e.isLoading?((0,s.wg)(),(0,s.j4)(U,{key:0})):e.$store.getters.categories.length?((0,s.wg)(),(0,s.iD)("form",{key:2,class:"form",onSubmit:t[5]||(t[5]=(0,n.iM)(((...e)=>L.sendRecord&&L.sendRecord(...e)),["prevent"]))},[(0,s._)("div",c,[(0,s.wy)((0,s._)("select",{ref:"select","onUpdate:modelValue":t[0]||(t[0]=t=>e.activeOption=t)},[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(e.$store.getters.categories,(e=>((0,s.wg)(),(0,s.iD)("option",{value:e.id,key:e.id},(0,a.zw)(e.title),9,m)))),128))],512),[[n.bM,e.activeOption]]),p]),(0,s._)("div",h,[(0,s._)("label",y,[(0,s.wy)((0,s._)("input",{class:"with-gap",name:"type",type:"radio",value:"income","onUpdate:modelValue":t[1]||(t[1]=t=>e.typeMoney=t)},null,512),[[n.G2,e.typeMoney]]),v]),(0,s._)("label",g,[(0,s.wy)((0,s._)("input",{class:"with-gap",name:"type",type:"radio",value:"outcome","onUpdate:modelValue":t[2]||(t[2]=t=>e.typeMoney=t)},null,512),[[n.G2,e.typeMoney]]),$])]),(0,s._)("div",w,[(0,s.wy)((0,s._)("input",{id:"amount",type:"number","onUpdate:modelValue":t[3]||(t[3]=t=>e.amount=t),class:(0,a.C_)({invalid:e.v$.amount.$errors.length})},null,2),[[n.nr,e.amount,void 0,{number:!0}]]),f,L.isLimit?((0,s.wg)(),(0,s.iD)("small",_,"Минимальная величина "+(0,a.zw)(L.maxLimit),1)):(0,s.kq)("",!0)]),(0,s._)("div",b,[(0,s.wy)((0,s._)("input",{id:"description",type:"text","onUpdate:modelValue":t[4]||(t[4]=t=>e.description=t),class:(0,a.C_)({invalid:e.v$.description.$errors.length})},null,2),[[n.nr,e.description,void 0,{trim:!0}]]),k,e.v$.description.$errors?((0,s.wg)(!0),(0,s.iD)(s.HY,{key:0},(0,s.Ko)(e.v$.description.$errors,(e=>((0,s.wg)(),(0,s.iD)("small",C,(0,a.zw)(L.addError(e.$validator,e.$params.min)),1)))),256)):(0,s.kq)("",!0)]),D],32)):((0,s.wg)(),(0,s.iD)("p",l,[d,(0,s.Wm)(V,{to:"/categories"},{default:(0,s.w5)((()=>[u])),_:1})]))])}var U=i(4137),V=i(1033),O=i(9117),x=i(65),q={components:{Loader:V.Z},data:()=>({v$:(0,U.ZP)(),isLoading:!0,select:null,activeOption:null,typeMoney:"income",amount:0,description:""}),validations(){return{amount:{required:O.C1,minValue:(0,O.uv)(10)},description:{required:O.C1,minLength:(0,O.Ei)(2)}}},methods:{formatDate(e){const t=e.split("T")[0].split("-").reverse().join("."),i=e.split("T")[1].split(".")[0];return i+" "+t},async sendRecord(){if(this.v$.$invalid)return this.v$.$touch();if(this.isCanCreateAmount)try{await this.$store.dispatch("sendAmount",{id:this.activeOption,typeMoney:this.typeMoney,amount:this.amount,description:this.description,date:(new Date).toJSON()});const e="income"===this.typeMoney?this.info.money+this.amount:this.info.money-this.amount;await this.$store.dispatch("updateInfo",e),this.$alert("Запись создана!"),this.activeOption=this.$store.getters.categories[0].id,this.description="",this.amount=0,this.v$.$reset()}catch(e){}else this.$alert("Не хватает "+(this.amount-this.info.money))},addError(e,t=0){return"required"===e?"Поле не должно быть пустым":"minLength"===e?`Минимальная длина должна быть ${t} символа`:void 0}},computed:{...(0,x.Se)(["info"]),isLimit(){return this.v$.amount.$errors.length&&this.amount<this.v$.amount.minValue.$params.min},maxLimit(){return this.v$.amount.minValue.$params.min},isCanCreateAmount(){return"income"===this.typeMoney||this.info.money>=this.amount}},async mounted(){await this.$store.dispatch("getCategories"),this.isLoading=!1,setTimeout((()=>{this.select=M.FormSelect.init(this.$refs.select),M.updateTextFields()}),0),this.$store.getters.categories.length&&(this.activeOption=this.$store.getters.categories[0].id)},destroyed(){this.select&&this.select.destroy&&this.select.destroy()}},S=i(89);const T=(0,S.Z)(q,[["render",L],["__scopeId","data-v-1ab75e4e"]]);var z=T}}]);
//# sourceMappingURL=704.9f7d75cd.js.map