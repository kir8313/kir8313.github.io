"use strict";(self["webpackChunkcrm_system"]=self["webpackChunkcrm_system"]||[]).push([[586],{1586:function(t,i,e){e.r(i),e.d(i,{default:function(){return W}});var s=e(3396);const l=(0,s._)("div",{class:"page-title"},[(0,s._)("h3",null,"Категории")],-1),r={key:1,class:"row"};function a(t,i,e,a,n,o){const m=(0,s.up)("loader"),d=(0,s.up)("the-category-create"),c=(0,s.up)("the-category-edit");return(0,s.wg)(),(0,s.iD)("div",null,[l,(0,s._)("section",null,[t.isLoading?((0,s.wg)(),(0,s.j4)(m,{key:0})):((0,s.wg)(),(0,s.iD)("div",r,[(0,s.Wm)(d),((0,s.wg)(),(0,s.j4)(c,{categories:o.categories,key:o.categories.length+t.updCount,onUpdate:i[0]||(i[0]=i=>t.updCount++)},null,8,["categories"]))]))])])}var n=e(9242),o=e(7139);const m={class:"col s12 m6"},d=(0,s._)("div",{class:"page-subtitle"},[(0,s._)("h4",null,"Создать")],-1),c={class:"input-field"},u=(0,s._)("label",{for:"name"},"Название",-1),h={class:"helper-text invalid"},v={class:"input-field"},g=(0,s._)("label",{for:"limit"},"Лимит",-1),p={key:0,class:"helper-text invalid"},$=(0,s._)("button",{class:"btn waves-effect waves-light",type:"submit"},[(0,s.Uk)(" Создать "),(0,s._)("i",{class:"material-icons right"},"send")],-1);function y(t,i,e,l,r,a){return(0,s.wg)(),(0,s.iD)("div",m,[(0,s._)("div",null,[d,(0,s._)("form",{onSubmit:i[2]||(i[2]=(0,n.iM)(((...t)=>a.submitForm&&a.submitForm(...t)),["prevent"]))},[(0,s._)("div",c,[(0,s.wy)((0,s._)("input",{id:"name",type:"text","onUpdate:modelValue":i[0]||(i[0]=t=>r.title=t),class:(0,o.C_)({invalid:r.v$.title.$errors.length})},null,2),[[n.nr,r.title,void 0,{trim:!0}]]),u,r.v$.title.$errors?((0,s.wg)(!0),(0,s.iD)(s.HY,{key:0},(0,s.Ko)(r.v$.title.$errors,(t=>((0,s.wg)(),(0,s.iD)("small",h,(0,o.zw)(a.addError(t.$validator,t.$params.min)),1)))),256)):(0,s.kq)("",!0)]),(0,s._)("div",v,[(0,s.wy)((0,s._)("input",{id:"limit",type:"number","onUpdate:modelValue":i[1]||(i[1]=t=>r.limit=t),class:(0,o.C_)({invalid:r.v$.limit.$errors.length})},null,2),[[n.nr,r.limit,void 0,{number:!0}]]),g,a.isLimit?((0,s.wg)(),(0,s.iD)("small",p,"Минимальная величина "+(0,o.zw)(a.maxLimit),1)):(0,s.kq)("",!0)]),$],32)])])}var w=e(4137),_=e(9117),f={data(){return{v$:(0,w.ZP)(),title:"",limit:0}},validations(){return{title:{required:_.C1,minLength:(0,_.Ei)(2)},limit:{required:_.C1,minValue:(0,_.uv)(100)}}},methods:{async submitForm(){if(this.v$.$invalid)return this.v$.$touch();try{await this.$store.dispatch("sendCategory",{title:this.title,limit:this.limit}),this.title="",this.limit=0,this.$alert("Категория успешно создана!"),this.v$.$reset()}catch(t){}},addError(t,i=0){return"required"===t?"Поле не должно быть пустым":"minLength"===t?`Минимальная длина должна быть ${i} символа`:void 0}},mounted(){M.updateTextFields()},computed:{isLimit(){return this.v$.limit.$errors.length&&this.limit<this.v$.limit.minValue.$params.min},maxLimit(){return this.v$.limit.minValue.$params.min}}},b=e(89);const C=(0,b.Z)(f,[["render",y]]);var k=C;const L={class:"col s12 m6"},D={key:0},x=(0,s._)("div",{class:"page-subtitle"},[(0,s._)("h4",null,"Редактировать")],-1),V={class:"input-field"},q=["value"],O=(0,s._)("label",null,"Выберите категорию",-1),U={class:"input-field"},E=(0,s._)("label",{for:"name"},"Название",-1),F={class:"helper-text invalid"},S={class:"input-field"},Z=(0,s._)("label",{for:"limit"},"Лимит",-1),z={key:0,class:"helper-text invalid"},T=(0,s._)("button",{class:"btn waves-effect waves-light",type:"submit"},[(0,s.Uk)(" Обновить "),(0,s._)("i",{class:"material-icons right"},"send")],-1),H={key:1,class:"center"};function K(t,i,e,l,r,a){return(0,s.wg)(),(0,s.iD)("div",L,[e.categories.length?((0,s.wg)(),(0,s.iD)("div",D,[x,(0,s._)("form",{onSubmit:i[3]||(i[3]=(0,n.iM)(((...t)=>a.changeCategory&&a.changeCategory(...t)),["prevent"]))},[(0,s._)("div",V,[(0,s.wy)((0,s._)("select",{ref:"select","onUpdate:modelValue":i[0]||(i[0]=i=>t.activeOption=i)},[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(e.categories,(t=>((0,s.wg)(),(0,s.iD)("option",{value:t.id,key:t.id},(0,o.zw)(t.title),9,q)))),128))],512),[[n.bM,t.activeOption]]),O]),(0,s._)("div",U,[(0,s.wy)((0,s._)("input",{id:"name",type:"text","onUpdate:modelValue":i[1]||(i[1]=i=>t.title=i),class:(0,o.C_)({invalid:t.v$.title.$errors.length})},null,2),[[n.nr,t.title,void 0,{trim:!0}]]),E,t.v$.title.$errors?((0,s.wg)(!0),(0,s.iD)(s.HY,{key:0},(0,s.Ko)(t.v$.title.$errors,(t=>((0,s.wg)(),(0,s.iD)("small",F,(0,o.zw)(a.addError(t.$validator,t.$params.min)),1)))),256)):(0,s.kq)("",!0)]),(0,s._)("div",S,[(0,s.wy)((0,s._)("input",{id:"limit",type:"number","onUpdate:modelValue":i[2]||(i[2]=i=>t.limit=i),class:(0,o.C_)({invalid:t.v$.limit.$errors.length})},null,2),[[n.nr,t.limit,void 0,{number:!0}]]),Z,a.isLimit?((0,s.wg)(),(0,s.iD)("small",z,"Минимальная величина "+(0,o.zw)(a.maxLimit),1)):(0,s.kq)("",!0)]),T],32)])):((0,s.wg)(),(0,s.iD)("p",H,"Добавьте первую категорию"))])}var Y={props:["categories"],emits:["update"],data:()=>({v$:(0,w.ZP)(),title:"",limit:0,select:null,activeOption:null}),created(){if(this.categories.length){const{title:t,id:i,limit:e}=this.categories[0];this.activeOption=i,this.limit=e,this.title=t}},validations(){return{title:{required:_.C1,minLength:(0,_.Ei)(2)},limit:{required:_.C1,minValue:(0,_.uv)(100)}}},methods:{async changeCategory(){if(this.v$.$invalid)return this.v$.$touch();try{const{limit:t,title:i}=this.categories.find((t=>t.id===this.activeOption));if(this.title===i&&this.limit===t)return this.$alert("Имя и лимит у категории не могут быть одинаковыми!");await this.$store.dispatch("changeCategory",{title:this.title,limit:this.limit,id:this.activeOption}),this.$alert("Категория изменена!"),this.$emit("update"),this.v$.$reset()}catch(t){}},addError(t,i=0){return"required"===t?"Поле не должно быть пустым":"minLength"===t?`Минимальная длина должна быть ${i} символа`:void 0}},computed:{isLimit(){return this.v$.limit.$errors.length&&this.limit<this.v$.limit.minValue.$params.min},maxLimit(){return this.v$.limit.minValue.$params.min}},watch:{activeOption(t){const{limit:i,title:e}=this.categories.find((i=>i.id===t));this.limit=i,this.title=e}},mounted(){this.select=M.FormSelect.init(this.$refs.select),M.updateTextFields()},destroyed(){this.select&&this.select.destroy&&this.select.destroy()}};const j=(0,b.Z)(Y,[["render",K]]);var I=j,P=e(1033),J={components:{Loader:P.Z,TheCategoryEdit:I,TheCategoryCreate:k},data:()=>({isLoading:!0,updCount:0}),computed:{categories(){return this.$store.getters.categories?this.$store.getters.categories:localStorage.getItem("categories")?JSON.parse(localStorage.getItem("categories")):[]}},async mounted(){await this.$store.dispatch("getCategories"),this.isLoading=!1}};const N=(0,b.Z)(J,[["render",a]]);var W=N}}]);
//# sourceMappingURL=586.38fcedad.js.map